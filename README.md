# Thermal Anomaly Detection System
**Euclidean Technologies - Advanced Man-Made Anomaly Detection**

A production-grade deep learning system for detecting man-made thermal anomalies in satellite imagery (400â€“2500 nm) using Swin Transformer U-Net architecture.

---

## ğŸ¯ Overview

This system detects buildings, vehicles, industrial facilities, and other man-made structures in thermal and hyperspectral satellite imagery through a multi-stage pipeline combining statistical methods, deep learning, and material characterization.

**Key Capabilities:**
- Multi-sensor support (Landsat, Sentinel-2, ASTER, MODIS)
- Dual-mode processing: Fast statistical + Deep learning
- Multi-modal fusion (thermal + hyperspectral)
- Material characterization via emissivity and spectral analysis
- Scalable from edge devices to cloud clusters

---

## ğŸ”„ Complete Pipeline Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PIPELINE OVERVIEW                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. DATA INPUT  â”‚
â”‚   Multi-Sensor â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â–º Landsat (TIF, HE5)
         â”œâ”€â–º Sentinel-2 (TIF)
         â”œâ”€â–º ASTER (HE5, MAT)
         â””â”€â–º MODIS (HDF)
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. PREPROCESSING & NORMALIZATION                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚Format Parser â”‚â”€â”€â”€â–ºâ”‚Band Extractionâ”‚â”€â”€â”€â–ºâ”‚ Validation   â”‚             â”‚
â”‚  â”‚(he5/mat/tif) â”‚    â”‚ (thermal/HSI) â”‚    â”‚ (NaN, range) â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                   â”‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ROBUST NORMALIZATION (per-band)                                  â”‚  â”‚
â”‚  â”‚   Î¼_b = median(X_b)                                              â”‚  â”‚
â”‚  â”‚   Ïƒ_b = median(|X_b âˆ’ Î¼_b|) + Îµ                                 â”‚  â”‚
â”‚  â”‚   Z_b = (X_b âˆ’ Î¼_b) / Ïƒ_b                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                    â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ LOCAL BACKGROUND MODELING (5Ã—5 km windows)                       â”‚  â”‚
â”‚  â”‚   â€¢ Terrain-adjusted baseline                                    â”‚  â”‚
â”‚  â”‚   â€¢ Diurnal correction                                           â”‚  â”‚
â”‚  â”‚   â€¢ Spatial context preservation                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                                              â”‚
         â–¼                                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3A. FAST PATH       â”‚                                    â”‚ 3B. DEEP LEARNING   â”‚
â”‚  (Statistical)      â”‚                                    â”‚  (Neural Network)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     â”‚                                    â”‚                     â”‚
â”‚ THERMAL THRESHOLD:  â”‚                                    â”‚ SWIN TRANSFORMER    â”‚
â”‚  Ï„_build = Î¼+2Ïƒ    â”‚                                    â”‚      U-NET          â”‚
â”‚  Ï„_vehicle = Î¼+3Ïƒ  â”‚                                    â”‚                     â”‚
â”‚  Ï„_indust = Î¼+4Ïƒ   â”‚                                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                     â”‚                                    â”‚ â”‚  ENCODER        â”‚ â”‚
â”‚ mask = (T > Ï„)     â”‚                                    â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚                     â”‚                                    â”‚ â”‚ â”‚PatchEmbed   â”‚ â”‚ â”‚
â”‚ HSI RX DETECTOR:    â”‚                                    â”‚ â”‚ â”‚  (4Ã—4)      â”‚ â”‚ â”‚
â”‚  z = (xâˆ’Î¼) âŠ˜ Ïƒ    â”‚                                    â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  s_RX = ||z||Â²    â”‚                                    â”‚ â”‚        â”‚        â”‚ â”‚
â”‚                     â”‚                                    â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ PCA GENERATIVE:     â”‚                                    â”‚ â”‚ â”‚ Swin Stage1 â”‚ â”‚ â”‚
â”‚  xÌ‚ = P_kÂ·P_k^TÂ·x   â”‚                                    â”‚ â”‚ â”‚ depth=2,h=3 â”‚ â”‚ â”‚
â”‚  s_RE = ||xâˆ’xÌ‚||Â²  â”‚                                    â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚                     â”‚                                    â”‚ â”‚   PatchMerge   â”‚ â”‚
â”‚ COMBINED:           â”‚                                    â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  s = 0.6Â·RX+0.4Â·RE â”‚                                    â”‚ â”‚ â”‚ Swin Stage2 â”‚ â”‚ â”‚
â”‚  mask = (s>Î¼+6Ïƒ)   â”‚                                    â”‚ â”‚ â”‚ depth=2,h=6 â”‚ â”‚ â”‚
â”‚                     â”‚                                    â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ Speed: ~100 FPS CPU â”‚                                    â”‚ â”‚   PatchMerge   â”‚ â”‚
â”‚                     â”‚                                    â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚ â”‚ â”‚ Swin Stage3 â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”‚ depth=6,h=12â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
           â”‚                                               â”‚ â”‚   PatchMerge   â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”‚ Swin Stage4 â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”‚ depth=2,h=24â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
           â”‚                                               â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
           â”‚                                               â”‚          â”‚          â”‚
           â”‚                                               â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
           â”‚                                               â”‚ â”‚  DECODER        â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”‚  Upsample   â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”‚+ Skip(feat3)â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”‚ Dec Block 1 â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”‚  (512 ch)   â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”‚  Upsample   â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”‚+ Skip(feat2)â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”‚ Dec Block 2 â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”‚  (256 ch)   â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”‚  Upsample   â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”‚+ Skip(feat1)â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”‚ Dec Block 3 â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”‚  (128 ch)   â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”‚  Upsample   â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”‚ Dec Block 4 â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”‚   (64 ch)   â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”‚   1Ã—1 Conv  â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â”‚ 2 classes   â”‚ â”‚ â”‚
           â”‚                                               â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
           â”‚                                               â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
           â”‚                                               â”‚          â”‚          â”‚
           â”‚                                               â”‚    Logitsâ†’Sigmoid   â”‚
           â”‚                                               â”‚          â”‚          â”‚
           â”‚                                               â”‚    prob = Ïƒ(L)      â”‚
           â”‚                                               â”‚    mask = (p>0.5)   â”‚
           â”‚                                               â”‚                     â”‚
           â”‚                                               â”‚ Speed: ~40 FPS GPU  â”‚
           â”‚                                               â”‚                     â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. MULTI-MODAL FUSION (optional)                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Thermal Mask â”‚    â”‚  HSI Mask    â”‚    â”‚ Fusion Logic â”‚             â”‚
â”‚  â”‚ (buildings,  â”‚â”€â”€â”€â–ºâ”‚ (spectral    â”‚â”€â”€â”€â–ºâ”‚ â€¢ Union      â”‚             â”‚
â”‚  â”‚  vehicles,   â”‚    â”‚  anomalies)  â”‚    â”‚ â€¢ Intersectionâ”‚            â”‚
â”‚  â”‚  industrial) â”‚    â”‚              â”‚    â”‚ â€¢ Weighted   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                   â”‚                      â”‚
â”‚                                          fused_mask = M_th âˆª M_hsi      â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. POST-PROCESSING (configurable via no_filters flag)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  if no_filters = false:                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Morphologicalâ”‚â”€â”€â”€â–ºâ”‚     CRF      â”‚â”€â”€â”€â–ºâ”‚  Geometric   â”‚             â”‚
â”‚  â”‚  â€¢ Opening   â”‚    â”‚  Refinement  â”‚    â”‚   Filters    â”‚             â”‚
â”‚  â”‚  â€¢ Closing   â”‚    â”‚  (optional)  â”‚    â”‚ â€¢ min_area   â”‚             â”‚
â”‚  â”‚  â€¢ Remove    â”‚    â”‚              â”‚    â”‚ â€¢ aspect     â”‚             â”‚
â”‚  â”‚    speckles  â”‚    â”‚              â”‚    â”‚ â€¢ circularityâ”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                   â”‚                      â”‚
â”‚  if no_filters = true:                           â”‚                      â”‚
â”‚    â†’ Skip directly to material characterization  â”‚                      â”‚
â”‚                                                   â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. MATERIAL CHARACTERIZATION                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ THERMAL EMISSIVITY ANALYSIS                                     â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â€¢ Extract anomaly pixel temperatures                           â”‚   â”‚
â”‚  â”‚  â€¢ Compute mean, max, std, local contrast                       â”‚   â”‚
â”‚  â”‚  â€¢ Heuristic classification:                                    â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚    if contrast > 2.5Ïƒ AND T > p95:                              â”‚   â”‚
â”‚  â”‚      â†’ LOW_EMISSIVITY_METAL/ROOF                                â”‚   â”‚
â”‚  â”‚    elif contrast > 1.0Ïƒ:                                        â”‚   â”‚
â”‚  â”‚      â†’ MEDIUM_EMISSIVITY_ASPHALT/CONCRETE                       â”‚   â”‚
â”‚  â”‚    else:                                                         â”‚   â”‚
â”‚  â”‚      â†’ HIGH_EMISSIVITY_SOIL/VEGETATION                          â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SPECTRAL MATERIAL ANALYSIS (Hyperspectral)                      â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â€¢ Extract mean spectrum from anomaly pixels                    â”‚   â”‚
â”‚  â”‚  â€¢ Compute absorption depths:                                   â”‚   â”‚
â”‚  â”‚      d_1400, d_1900 (water)                                     â”‚   â”‚
â”‚  â”‚      d_1000 (Fe-oxide)                                          â”‚   â”‚
â”‚  â”‚      d_2200 (OH/clay)                                           â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â€¢ Material classification:                                     â”‚   â”‚
â”‚  â”‚    if d_1400 < 0.1 AND d_1900 < 0.1:                            â”‚   â”‚
â”‚  â”‚      â†’ DRY_MINERAL/ASPHALT/CONCRETE                             â”‚   â”‚
â”‚  â”‚    if d_1000 > 0.25 AND d_2200 > 0.2:                           â”‚   â”‚
â”‚  â”‚      â†’ OXIDIZED_MINERAL/CLAY                                    â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. OUTPUT GENERATION                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  GeoTIFF     â”‚    â”‚ Probability  â”‚    â”‚     RGB      â”‚             â”‚
â”‚  â”‚   Masks      â”‚    â”‚  Heatmaps    â”‚    â”‚   Overlays   â”‚             â”‚
â”‚  â”‚ (binary LZW) â”‚    â”‚ (Float32)    â”‚    â”‚ (300 DPI PNG)â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ STRUCTURED REPORTS (JSON/CSV)                                    â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  {                                                                â”‚  â”‚
â”‚  â”‚    "scene_id": "LC08_001002_20231015",                           â”‚  â”‚
â”‚  â”‚    "metrics": {                                                   â”‚  â”‚
â”‚  â”‚      "accuracy": 0.95, "f1_score": 0.90,                         â”‚  â”‚
â”‚  â”‚      "precision": 0.92, "recall": 0.88                           â”‚  â”‚
â”‚  â”‚    },                                                             â”‚  â”‚
â”‚  â”‚    "detections": [                                                â”‚  â”‚
â”‚  â”‚      {                                                            â”‚  â”‚
â”‚  â”‚        "id": 1,                                                   â”‚  â”‚
â”‚  â”‚        "centroid": [34.052, -118.243],                           â”‚  â”‚
â”‚  â”‚        "area_pixels": 1523,                                      â”‚  â”‚
â”‚  â”‚        "confidence": 0.94,                                       â”‚  â”‚
â”‚  â”‚        "material_class": "ASPHALT/CONCRETE",                     â”‚  â”‚
â”‚  â”‚        "mean_temp": 312.5,                                       â”‚  â”‚
â”‚  â”‚        "local_contrast": 8.3                                     â”‚  â”‚
â”‚  â”‚      }                                                            â”‚  â”‚
â”‚  â”‚    ]                                                              â”‚  â”‚
â”‚  â”‚  }                                                                â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Training Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        TRAINING WORKFLOW                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ config.yaml  â”‚
â”‚  + splits    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DATA MODULE INITIALIZATION                                              â”‚
â”‚  â€¢ Scan data/ directory for supported formats                           â”‚
â”‚  â€¢ Load train.json, val.json, test.json splits                          â”‚
â”‚  â€¢ Create DataLoaders (batch_size=8, workers=8, pin_memory=True)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MODEL INITIALIZATION                                                     â”‚
â”‚  â€¢ Create Swin U-Net (backbone=swin_tiny, input_ch=1, classes=2)        â”‚
â”‚  â€¢ Move to GPU, wrap in DataParallel if multi-GPU                       â”‚
â”‚  â€¢ Initialize weights (kaiming_normal for conv, trunc_normal for linear)â”‚
â”‚  â€¢ Count parameters (~28M for swin_tiny)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OPTIMIZER & SCHEDULER SETUP                                             â”‚
â”‚  â€¢ Optimizer: AdamW (lr=1e-4, wd=1e-5, betas=(0.9,0.999))               â”‚
â”‚  â€¢ Scheduler: CosineAnnealingLR (T_max=epochs)                          â”‚
â”‚  â€¢ GradScaler: torch.amp.GradScaler for mixed precision                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TRAINING LOOP (epochs=50)                                               â”‚
â”‚                                                                          â”‚
â”‚  FOR epoch IN range(epochs):                                            â”‚
â”‚                                                                          â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚ TRAIN EPOCH                                                  â”‚    â”‚
â”‚    â”‚                                                               â”‚    â”‚
â”‚    â”‚  model.train()                                               â”‚    â”‚
â”‚    â”‚                                                               â”‚    â”‚
â”‚    â”‚  FOR batch IN train_loader:                                  â”‚    â”‚
â”‚    â”‚    1. Load: images, masks â†’ GPU                              â”‚    â”‚
â”‚    â”‚    2. Forward (with AMP):                                    â”‚    â”‚
â”‚    â”‚         with autocast():                                     â”‚    â”‚
â”‚    â”‚           logits = model(images)                             â”‚    â”‚
â”‚    â”‚           L = combined_loss(logits, masks)                   â”‚    â”‚
â”‚    â”‚             = 0.5Â·BCE + 0.3Â·Dice + 0.2Â·Focal                 â”‚    â”‚
â”‚    â”‚    3. Backward:                                              â”‚    â”‚
â”‚    â”‚         scaler.scale(L).backward()                           â”‚    â”‚
â”‚    â”‚    4. Gradient clip:                                         â”‚    â”‚
â”‚    â”‚         scaler.unscale_(optimizer)                           â”‚    â”‚
â”‚    â”‚         clip_grad_norm_(params, max_norm=1.0)                â”‚    â”‚
â”‚    â”‚    5. Optimizer step:                                        â”‚    â”‚
â”‚    â”‚         scaler.step(optimizer)                               â”‚    â”‚
â”‚    â”‚         scaler.update()                                      â”‚    â”‚
â”‚    â”‚    6. Accumulate metrics (loss, predictions, targets)        â”‚    â”‚
â”‚    â”‚                                                               â”‚    â”‚
â”‚    â”‚  Compute epoch metrics:                                      â”‚    â”‚
â”‚    â”‚    accuracy, F1, precision, recall, ROC-AUC, PR-AUC          â”‚    â”‚
â”‚    â”‚                                                               â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚ VALIDATION EPOCH (every val_frequency=5 epochs)              â”‚    â”‚
â”‚    â”‚                                                               â”‚    â”‚
â”‚    â”‚  model.eval()                                                â”‚    â”‚
â”‚    â”‚                                                               â”‚    â”‚
â”‚    â”‚  with torch.no_grad():                                       â”‚    â”‚
â”‚    â”‚    FOR batch IN val_loader:                                  â”‚    â”‚
â”‚    â”‚      1. Load: images, masks â†’ GPU                            â”‚    â”‚
â”‚    â”‚      2. Forward (with AMP):                                  â”‚    â”‚
â”‚    â”‚           logits = model(images)                             â”‚    â”‚
â”‚    â”‚           L = combined_loss(logits, masks)                   â”‚    â”‚
â”‚    â”‚      3. Accumulate metrics                                   â”‚    â”‚
â”‚    â”‚                                                               â”‚    â”‚
â”‚    â”‚  Compute epoch metrics:                                      â”‚    â”‚
â”‚    â”‚    accuracy, F1, precision, recall, ROC-AUC, PR-AUC          â”‚    â”‚
â”‚    â”‚                                                               â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚ CHECKPOINT & EARLY STOPPING                                  â”‚    â”‚
â”‚    â”‚                                                               â”‚    â”‚
â”‚    â”‚  if val_f1 > best_f1:                                        â”‚    â”‚
â”‚    â”‚    best_f1 = val_f1                                          â”‚    â”‚
â”‚    â”‚    save_checkpoint(epoch, model, optimizer, "best_model.pth")â”‚    â”‚
â”‚    â”‚    patience_counter = 0                                      â”‚    â”‚
â”‚    â”‚  else:                                                        â”‚    â”‚
â”‚    â”‚    patience_counter += 1                                     â”‚    â”‚
â”‚    â”‚                                                               â”‚    â”‚
â”‚    â”‚  if patience_counter >= patience (15):                       â”‚    â”‚
â”‚    â”‚    STOP TRAINING (early stopping)                            â”‚    â”‚
â”‚    â”‚                                                               â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â”‚    scheduler.step()  # Update learning rate                             â”‚
â”‚    log_metrics_to_csv(epoch, train_metrics, val_metrics, lr)            â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FINAL EVALUATION                                                         â”‚
â”‚  â€¢ Load best_model.pth                                                   â”‚
â”‚  â€¢ Run on test set                                                       â”‚
â”‚  â€¢ Compute final metrics                                                 â”‚
â”‚  â€¢ Generate sample submission outputs                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§® Mathematical Framework

### 1. Robust Normalization
```
Per-band scaling:
  Î¼_b = median(X_b)                    [robust central tendency]
  Ïƒ_b = median(|X_b âˆ’ Î¼_b|) + Îµ       [robust scale, MAD-based]
  Z_b = (X_b âˆ’ Î¼_b) / Ïƒ_b             [normalized band]

Example:
  Raw thermal band: [295, 298, 300, 302, 315, 305, 301, 299]
  Î¼ = 300.5, Ïƒ = 2.5
  Normalized: [-2.2, -1.0, -0.2, 0.6, 5.8, 1.8, 0.2, -0.6]
  â†’ Outlier at 315 clearly visible (z=5.8)
```

### 2. Fast Anomaly Detection

**Statistical Thermal Thresholding:**
```
Land mask: M_land = (T > 0)
Background stats over land:
  Î¼_land = mean(T[M_land])
  Ïƒ_land = std(T[M_land])

Adaptive thresholds:
  Ï„_building = Î¼_land + 2.0Â·Ïƒ_land
  Ï„_vehicle = Î¼_land + 3.0Â·Ïƒ_land
  Ï„_industrial = Î¼_land + 4.0Â·Ïƒ_land

Detection:
  M_anomaly = (T > Ï„_building) âˆ¨ (T > Ï„_vehicle) âˆ¨ (T > Ï„_industrial)

Example (Celsius):
  Î¼_land = 20Â°C, Ïƒ_land = 3Â°C
  Ï„_building = 26Â°C
  Ï„_vehicle = 29Â°C
  Ï„_industrial = 32Â°C
  â†’ Building at 28Â°C flagged
  â†’ Vehicle engine at 35Â°C flagged
```

**RX Anomaly Detector (Hyperspectral):**
```
Robust z-scoring:
  Î¼ = median(X, axis=pixels)           [per-band median]
  Ïƒ = median(|X âˆ’ Î¼|, axis=pixels)     [per-band MAD]
  Z = (X âˆ’ Î¼) âŠ˜ Ïƒ                      [element-wise division]

RX score (diagonal Mahalanobis):
  s_RX(x) = ||z||Â²â‚‚ = Î£_b z_bÂ²

Threshold:
  Ï„_RX = median(s_RX) + 6Â·MAD(s_RX)

Example (5 bands):
  z = [0.5, 1.2, 0.8, 6.5, 1.0]
  s_RX = 0.25 + 1.44 + 0.64 + 42.25 + 1.0 = 45.58
  If median(s_RX) = 5.0, MAD = 2.0, Ï„ = 5+6Â·2 = 17
  â†’ s_RX=45.58 > 17 â†’ ANOMALY
```

**PCA Reconstruction Error (Generative Proxy):**
```
Fit PCA on normalized spectra:
  X_centered = X âˆ’ Î¼
  [U, S, V] = SVD(X_centered)
  P_k = V[:, :k]                       [top k components]

Reconstruction:
  XÌ‚_centered = P_k Â· P_k^T Â· X_centered
  XÌ‚ = XÌ‚_centered + Î¼

Reconstruction error:
  s_RE(x) = ||x_centered âˆ’ xÌ‚_centered||Â²â‚‚

Combined score:
  s(x) = 0.6Â·normalize(s_RX(x)) + 0.4Â·normalize(s_RE(x))

Example:
  s_RX_norm = 0.8, s_RE_norm = 0.9
  s = 0.6Â·0.8 + 0.4Â·0.9 = 0.48 + 0.36 = 0.84
  If Ï„_combined = 0.7 â†’ ANOMALY
```

### 3. Neural Network (Swin U-Net)

**Patch Embedding:**
```
Input: I âˆˆ R^{HÃ—WÃ—C}
Patch size: p = 4
Number of patches: n = (H/p) Ã— (W/p)

Conv projection:
  E = Conv_{pÃ—p,stride=p}(I)           [shape: (H/p, W/p, d)]
  E_flat = flatten(E)                  [shape: (n, d)]

Example:
  Input: 512Ã—512Ã—1
  After embedding: 128Ã—128 patches, each 96-dim
  Total tokens: 16,384
```

**Windowed Self-Attention:**
```
Window size: w = 7
Within each wÃ—w window:

  Q = Linear_Q(X), K = Linear_K(X), V = Linear_V(X)
  
  Attention scores:
    A = softmax((QÂ·K^T)/âˆšd_head + B_rel)
  
  Output:
    Y = AÂ·V

Relative position bias:
  B_rel[i,j] = learned_table[Î”h, Î”w]
  where Î”h = row_i âˆ’ row_j, Î”w = col_i âˆ’ col_j

Shifted windows (alternating blocks):
  shift_size = w/2 = 3
  X_shifted = roll(X, shifts=(-3, -3), dims=(H,W))
  â†’ Enables cross-window interaction

Example attention:
  Patch at (5,5) attends to patches in window [(3,3) to (9,9)]
  With shift, next layer attends to window [(0,0) to (6,6)]
  â†’ Full receptive field grows quadratically
```

**Patch Merging (Downsampling):**
```
Input: X âˆˆ R^{HÃ—WÃ—C}

Spatial downsampling by 2:
  X_0 = X[0::2, 0::2, :]               [top-left quadrant]
  X_1 = X[1::2, 0::2, :]               [bottom-left]
  X_2 = X[0::2, 1::2, :]               [top-right]
  X_3 = X[1::2, 1::2, :]               [bottom-right]
  
  X_concat = concat([X_0, X_1, X_2, X_3], dim=-1)  [shape: (H/2, W/2, 4C)]
  
  X_out = LayerNorm(X_concat)
  X_out = Linear_{4Câ†’2C}(X_out)        [shape: (H/2, W/2, 2C)]

Example:
  Input: 128Ã—128Ã—96
  Output: 64Ã—64Ã—192
  â†’ Halves spatial resolution, doubles channels
```

**U-Net Decoder:**
```
FOR each decoder stage i:
  
  1. Upsample by 2:
       X_up = interpolate(X, scale_factor=2, mode='bilinear')
  
  2. Concatenate skip connection:
       X_cat = concat([X_up, skip_features_i], dim=channels)
  
  3. Convolutional refinement:
       X_out = ReLU(BN(Conv_3Ã—3(X_cat)))
       X_out = ReLU(BN(Conv_3Ã—3(X_out)))

Example:
  Bottleneck: 16Ã—16Ã—768
  â†“ Upsample: 32Ã—32Ã—768
  â†“ + Skip(32Ã—32Ã—384): 32Ã—32Ã—1152
  â†“ Conv blocks: 32Ã—32Ã—512
```

**Loss Functions:**
```
Binary Cross-Entropy:
  BCE(p, y) = -[yÂ·log(p) + (1âˆ’y)Â·log(1âˆ’p)]
  where p = Ïƒ(logits)

Dice Loss:
  intersection = Î£(p Â· y)
  union = Î£p + Î£y
  Dice = (2Â·intersection + Îµ) / (union + Îµ)
  Loss_Dice = 1 âˆ’ Dice

Focal Loss (handles class imbalance):
  p_t = p if y=1 else (1âˆ’p)
  Focal = -Î±Â·(1 âˆ’ p_t)^Î³ Â· log(p_t)
  Î±=1, Î³=2 (default)

Combined:
  L_total = 0.5Â·BCE + 0.3Â·Dice + 0.2Â·Focal

Example:
  For hard negative (y=0, p=0.1):
    BCE = -log(0.9) = 0.105
    p_t = 0.9, (1âˆ’p_t)^2 = 0.01
    Focal = -1Â·0.01Â·log(0.9) = 0.001
  â†’ Focal downweights easy examples
```

### 4. Material Characterization

**Thermal Emissivity Classification:**
```
Given anomaly mask M and thermal image T:

Extract anomaly temperatures:
  T_anom = T[M]
  Î¼_anom = mean(T_anom)
  Ïƒ_anom = std(T_anom)
  T_max = max(T_anom)

Compute local contrast:
  T_background = mean(T[Â¬M])
  contrast = Î¼_anom âˆ’ T_background

Classification rules:
  IF contrast > 2.5Â·Ïƒ_anom AND T_max > percentile(T, 95):
    â†’ LOW_EMISSIVITY_METAL/ROOF (Îµ â‰ˆ 0.85-0.92)
  
  ELIF contrast > 1.0Â·Ïƒ_anom:
    â†’ MEDIUM_EMISSIVITY_ASPHALT/CONCRETE (Îµ â‰ˆ 0.93-0.96)
  
  ELSE:
    â†’ HIGH_EMISSIVITY_SOIL/VEGETATION (Îµ â‰ˆ 0.95-0.98)

Example:
  Î¼_anom = 315K, Ïƒ_anom = 2K, T_background = 300K
  contrast = 15K, 2.5Â·Ïƒ = 5K
  15 > 5 â†’ Metal roof detected
```

**Spectral Material Classification:**
```
Extract mean spectrum from anomaly:
  S = mean(X[M, :], axis=pixels)      [average spectrum]

Normalize for depth computation:
  S_norm = (S âˆ’ min(S)) / (max(S) âˆ’ min(S) + Îµ)

Absorption depth at wavelength Î»:
  d(Î») = 1 âˆ’ S_norm[band_closest_to_Î»]

Key features:
  d_1400 = depth at 1400nm (water)
  d_1900 = depth at 1900nm (water)
  d_1000 = depth at 1000nm (Fe-oxide)
  d_2200 = depth at 2200nm (OH/clay)

Classification:
  IF d_1400 < 0.1 AND d_1900 < 0.1:
    â†’ DRY_MINERAL/ASPHALT/CONCRETE (low water)
  
  IF d_1000 > 0.25 AND d_2200 > 0.2:
    â†’ OXIDIZED_MINERAL/CLAY (iron+clay signature)

Example:
  d_1400 = 0.05, d_1900 = 0.03 â†’ Dry material (asphalt)
  d_1000 = 0.30, d_2200 = 0.25 â†’ Oxidized clay
```

---

## ğŸš€ Quick Start

### Installation
```bash
# Create environment
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# Install PyTorch with CUDA
pip install torch torchvision --index-url https://download.pytorch.org/whl/cu118

# Install dependencies
pip install rasterio numpy pandas scikit-learn opencv-python tqdm pyyaml h5py scipy pillow
```

### Training
```bash
# Edit config/config.yaml first
python src/train/train.py
```

### Inference
```python
from src.inference.thermal_inference import FastManMadeInference

config = {...}  # Load from config.yaml
detector = FastManMadeInference(config)

# Single image
mask = detector.run_inference("data/scene_001_ST_B10.TIF")

# Batch processing
results = detector.batch_inference("data/")

# Material characterization
materials = detector.characterize_thermal_emissivity(thermal_data, mask)
```

---

## ğŸ“ Project Structure

```
AIGR-S86462EUCLIDEAN_TECHNOLOGIES_THERMAL/
â”œâ”€â”€ config/config.yaml           # Configuration
â”œâ”€â”€ data/                        # Input data
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ dataloader/             # Data loading
â”‚   â”œâ”€â”€ models/                 # Model architectures
â”‚   â”œâ”€â”€ train/                  # Training pipeline
â”‚   â”œâ”€â”€ inference/              # Inference engine
â”‚   â””â”€â”€ utils/                  # Utilities
â”œâ”€â”€ outputs/
â”‚   â”œâ”€â”€ models/                 # Checkpoints
â”‚   â”œâ”€â”€ logs/                   # Training logs
â”‚   â””â”€â”€ submission/             # Results
â””â”€â”€ README.md
```

---

## ğŸ“Š Performance Metrics

- **Accuracy**: Pixel-wise classification accuracy
- **F1 Score**: Harmonic mean of precision/recall
- **Precision**: TP / (TP + FP)
- **Recall**: TP / (TP + FN)
- **ROC-AUC**: Area under ROC curve
- **PR-AUC**: Area under precision-recall curve

---

## ğŸ›¡ï¸ Security & Ethics

**Implemented:**
- Mixed precision training (numerical stability)
- Gradient clipping (prevents instability)
- Uncertainty quantification (flags low confidence)
- Audit logging (tracks all operations)
- Configuration validation (safe parameters)
- No-filters mode (user control)

**Ethical AI:**
- Transparent predictions with confidence scores
- Human-in-the-loop for ambiguous cases
- Bias mitigation through diverse validation
- Designed for environmental/disaster monitoring

---

## ğŸ“§ Contact

**Euclidean Technologies**  
Email: contact@euclideantech.ai  
Project: AIGR-S86462

---

**Built  by Euclidean Technologies**
